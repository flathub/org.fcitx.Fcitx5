app-id: org.fcitx.Fcitx5
base: io.qt.qtwebengine.BaseApp
base-version: 5.15-21.08
runtime: org.kde.Platform
runtime-version: 5.15-21.08
sdk: org.kde.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.llvm13
  - org.freedesktop.Sdk.Extension.vala
add-extensions:
  org.fcitx.Fcitx5.Addon:
    directory: addons
    subdirectories: true
    no-autodownload: true
    add-ld-path: lib
    autodelete: true
  org.fcitx.Fcitx5.Addon.Anthy:
    directory: addons/Anthy
    bundle: true
    no-autodownload: true
    add-ld-path: lib
    autodelete: true
  org.fcitx.Fcitx5.Addon.Chewing:
    directory: addons/Chewing
    bundle: true
    no-autodownload: true
    add-ld-path: lib
    autodelete: true
  org.fcitx.Fcitx5.Addon.ChineseAddons:
    directory: addons/ChineseAddons
    bundle: true
    no-autodownload: true
    add-ld-path: lib
    autodelete: true
  org.fcitx.Fcitx5.Addon.Hangul:
    directory: addons/Hangul
    bundle: true
    no-autodownload: true
    add-ld-path: lib
    autodelete: true
  org.fcitx.Fcitx5.Addon.Jyutping:
    directory: addons/Jyutping
    bundle: true
    no-autodownload: true
    add-ld-path: lib
    autodelete: true
  org.fcitx.Fcitx5.Addon.Kkc:
    directory: addons/Kkc
    bundle: true
    no-autodownload: true
    add-ld-path: lib
    autodelete: true
  org.fcitx.Fcitx5.Addon.LibThai:
    directory: addons/LibThai
    bundle: true
    no-autodownload: true
    add-ld-path: lib
    autodelete: true
  org.fcitx.Fcitx5.Addon.Lua:
    directory: addons/Lua
    bundle: true
    no-autodownload: true
    add-ld-path: lib
    autodelete: true
  org.fcitx.Fcitx5.Addon.M17N:
    directory: addons/M17N
    bundle: true
    no-autodownload: true
    add-ld-path: lib
    autodelete: true
  org.fcitx.Fcitx5.Addon.Mozc:
    directory: addons/Mozc
    bundle: true
    no-autodownload: true
    add-ld-path: lib
    autodelete: true
  org.fcitx.Fcitx5.Addon.Rime:
    directory: addons/Rime
    bundle: true
    no-autodownload: true
    add-ld-path: lib
    autodelete: true
  org.fcitx.Fcitx5.Addon.Sayura:
    directory: addons/Sayura
    bundle: true
    no-autodownload: true
    add-ld-path: lib
    autodelete: true
  org.fcitx.Fcitx5.Addon.Skk:
    directory: addons/Skk
    bundle: true
    no-autodownload: true
    add-ld-path: lib
    autodelete: true
  org.fcitx.Fcitx5.Addon.TableExtra:
    directory: addons/TableExtra
    bundle: true
    no-autodownload: true
    add-ld-path: lib
    autodelete: true
  org.fcitx.Fcitx5.Addon.TableOther:
    directory: addons/TableOther
    bundle: true
    no-autodownload: true
    add-ld-path: lib
    autodelete: true
  org.fcitx.Fcitx5.Addon.Unikey:
    directory: addons/Unikey
    bundle: true
    no-autodownload: true
    add-ld-path: lib
    autodelete: true
  org.fcitx.Fcitx5.Addon.Zhuyin:
    directory: addons/Zhuyin
    bundle: true
    no-autodownload: true
    add-ld-path: lib
    autodelete: true
build-options:
  append-path: /usr/lib/sdk/llvm13/bin:/usr/lib/sdk/vala/bin
  append-ld-library-path: /usr/lib/sdk/vala/lib
command: fcitx5
finish-args:
  - --socket=session-bus
  - --socket=x11
  - --socket=wayland
  - --share=network
  - --filesystem=xdg-config/fcitx5:create
  - --filesystem=xdg-data/fcitx5:create
  - --filesystem=xdg-config/fontconfig:ro
  - --filesystem=xdg-config/fcitx:create
  - --filesystem=xdg-config/ibus:create
  - --device=dri
cleanup:
  - /addons/*/include
  - /addons/*/lib/cmake
  - /addons/*/lib/pkgconfig
  - /include
  - /lib/cmake
  - /lib/pkgconfig
  - '*.a'
  - '*.la'
cleanup-commands:
  - /app/cleanup-BaseApp.sh
modules:
  - name: fcitx5
    buildsystem: cmake-ninja
    config-opts:
      - -DUSE_SYSTEMD=Off
      - -DENABLE_ENCHANT=Off
      - -DUSE_FLATPAK_ICON=On
    sources:
      - type: archive
        url: https://download.fcitx-im.org/fcitx5/fcitx5/fcitx5-5.0.15_dict.tar.xz
        sha256: f2ee4f946a363bfe806ba9a6e9d610a45eb4389603a473d1e8b3d9fbada551e5
        x-checker-data:
          type: html
          url: https://download.fcitx-im.org/fcitx5/fcitx5/
          version-pattern: fcitx5-([\d\.-]+)_dict.tar.xz
          url-template: https://download.fcitx-im.org/fcitx5/fcitx5/fcitx5-${version}_dict.tar.xz
      - type: file
        path: fcitx5.sh
    post-install:
      - install -d /app/addons
      - mv /app/bin/fcitx5{,-bin}
      - install -m755 fcitx5.sh /app/bin/fcitx5
    modules:
      - fmt/fmt.yaml
      - json-c/json-c.yaml
      - libevent/libevent.yaml
      - xcb-imdkit/xcb-imdkit.yaml
      - name: cldr-emoji-annotation
        sources:
          - type: archive
            url: https://github.com/fujiwarat/cldr-emoji-annotation/releases/download/37.0_13.0_0_2/cldr-emoji-annotation-37.0_13.0_0_2.tar.gz
            sha256: 7a24ea3dc17b814fbe8ee1127e1036679098ef2991b9266d738d375554210d13
            x-checker-data:
              type: anitya
              project-id: 13423
              stable-only: true
              url-template: https://github.com/fujiwarat/cldr-emoji-annotation/releases/download/$version/cldr-emoji-annotation-$version.tar.gz
          - type: shell
            commands:
              - sed '/^pkgconfigdir.*=/ s/datadir/libdir/' -i Makefile.am
              - autoreconf -fiv
  - name: fcitx5-qt
    buildsystem: cmake-ninja
    config-opts:
      - -DENABLE_QT4=Off
      - -DCMAKE_INSTALL_QT5PLUGINDIR=/app/lib/plugins
    sources:
      - type: archive
        url: https://download.fcitx-im.org/fcitx5/fcitx5-qt/fcitx5-qt-5.0.11.tar.xz
        sha256: 7196798d4c6f9305c028dab30a31eb64566b9b47b1cb916518d33f3a0f053d62
        x-checker-data:
          type: html
          url: https://download.fcitx-im.org/fcitx5/fcitx5-qt/
          version-pattern: fcitx5-qt-([\d\.-]+).tar.xz
          url-template: https://download.fcitx-im.org/fcitx5/fcitx5-qt/fcitx5-qt-$version.tar.xz
  - name: fcitx5-configtool
    buildsystem: cmake-ninja
    builddir: true
    sources:
      - type: archive
        url: https://download.fcitx-im.org/fcitx5/fcitx5-configtool/fcitx5-configtool-5.0.12.tar.xz
        sha256: 293da52dbac987a3c4880433a4a93bf8b3b45e2ac3d77cb025f76dc859302a1b
        x-checker-data:
          type: html
          url: https://download.fcitx-im.org/fcitx5/fcitx5-configtool/
          version-pattern: fcitx5-configtool-([\d\.-]+).tar.xz
          url-template: https://download.fcitx-im.org/fcitx5/fcitx5-configtool/fcitx5-configtool-$version.tar.xz

  # extensions dependencies
  - boost/boost.yaml
  - intltool/intltool.yaml
  - kyotocabinet/kyotocabinet.yaml
  - libgee/libgee.yaml
  - marisa/marisa.yaml
  - opencc/opencc.yaml

  - fcitx5-anthy/fcitx5-anthy.yaml
  - fcitx5-chewing/fcitx5-chewing.yaml
  - fcitx5-lua/fcitx5-lua.yaml
  # fcitx5-chinese-addons requires fcitx5-lua as make dependency
  - fcitx5-chinese-addons/fcitx5-chinese-addons.yaml
  - fcitx5-hangul/fcitx5-hangul.yaml
  - fcitx5-kkc/fcitx5-kkc.yaml
  - fcitx5-libthai/fcitx5-libthai.yaml
  - fcitx5-m17n/fcitx5-m17n.yaml
  - fcitx5-mozc/fcitx5-mozc.yaml
  - fcitx5-rime/fcitx5-rime.yaml
  - fcitx5-sayura/fcitx5-sayura.yaml
  - fcitx5-skk/fcitx5-skk.yaml
  # fcitx5-table-extra requires libime (fcitx5-chinese-addons) as make dependency
  - fcitx5-table-extra/fcitx5-table-extra.yaml
  # fcitx5-table-other requires libime (fcitx5-chinese-addons) as make dependency
  - fcitx5-table-other/fcitx5-table-other.yaml
  - fcitx5-unikey/fcitx5-unikey.yaml
  - fcitx5-zhuyin/fcitx5-zhuyin.yaml
  # libime-jyutping requires libime (fcitx5-chinese-addons) as make dependency
  - libime-jyutping/libime-jyutping.yaml
